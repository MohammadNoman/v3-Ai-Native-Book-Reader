## 6.1 The Interface Challenge

We now have a brain, but it needs a body. We will build a 'ChatKit' compatible widget that floats on our documentation site. This widget handles state, history, and the connection to our FastAPI backend.

## 6.2 The React Widget Component

This component uses React hooks to manage the chat lifecycle. It also listens for text selection events on the parent document to implement 'Context-Aware' querying.

<div className="bg-slate-900 p-6 rounded-lg my-6 border border-slate-700">
  <h4 className="text-brand-400 font-bold mb-2">src/components/ChatWidget.js</h4>
  <pre className="text-xs text-slate-300 overflow-x-auto">
{`import React, { useState, useEffect } from 'react';
import { Send, MessageSquare, X } from 'lucide-react';

export const ChatWidget = () => {
  const [isOpen, setIsOpen] = useState(false);
  const [messages, setMessages] = useState([]);
  const [input, setInput] = useState('');
  const [selection, setSelection] = useState('');

  // Listen for text selection on the doc page
  useEffect(() => {
    const handleSelection = () => {
      const text = window.getSelection().toString();
      if (text.length > 5) setSelection(text);
    };
    document.addEventListener('mouseup', handleSelection);
    return () => document.removeEventListener('mouseup', handleSelection);
  }, []);

  const sendMessage = async () => {
    if (!input.trim()) return;
    
    const userMsg = { role: 'user', text: input };
    setMessages(prev => [...prev, userMsg]);
    setInput('');

    try {
      const res = await fetch('http://localhost:8000/ask', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          message: userMsg.text,
          selected_context: selection // Send highlighted text as context
        })
      });
      const data = await res.json();
      setMessages(prev => [...prev, { role: 'model', text: data.reply }]);
      setSelection(''); // Clear selection after use
    } catch (e) {
      setMessages(prev => [...prev, { role: 'error', text: "Failed to reach agent." }]);
    }
  };

  if (!isOpen) {
    return (
      <button 
        onClick={() => setIsOpen(true)}
        className="fixed bottom-5 right-5 bg-blue-600 p-4 rounded-full text-white shadow-xl hover:scale-105 transition-transform"
      >
        <MessageSquare />
      </button>
    );
  }

  return (
    <div className="fixed bottom-5 right-5 w-96 h-[500px] bg-white rounded-lg shadow-2xl flex flex-col border border-gray-200 z-50">
      <div className="p-4 bg-slate-900 text-white rounded-t-lg flex justify-between items-center">
        <span className="font-bold">Docs Assistant</span>
        <button onClick={() => setIsOpen(false)}><X size={18} /></button>
      </div>
      
      <div className="flex-1 overflow-y-auto p-4 space-y-3">
        {messages.map((m, i) => (
          <div key={i} className={\`p-3 rounded-lg text-sm \${
            m.role === 'user' ? 'bg-blue-100 ml-8' : 'bg-gray-100 mr-8'
          }\`}>
            {m.text}
          </div>
        ))}
      </div>

      {selection && (
        <div className="px-4 py-2 bg-yellow-50 text-xs border-t border-yellow-100 truncate">
          <span className="font-bold">Context:</span> "{selection}"
        </div>
      )}

      <div className="p-3 border-t flex gap-2">
        <input 
          className="flex-1 border rounded px-3 py-2 text-sm focus:outline-none focus:border-blue-500"
          value={input}
          onChange={e => setInput(e.target.value)}
          onKeyDown={e => e.key === 'Enter' && sendMessage()}
          placeholder="Ask AI..."
        />
        <button onClick={sendMessage} className="bg-blue-600 text-white p-2 rounded hover:bg-blue-700">
          <Send size={18} />
        </button>
      </div>
    </div>
  );
};`}
  </pre>
</div>

## 6.3 Docusaurus Integration (Swizzling)

To make this widget appear on every page of our documentation site, we wrap the root application.

1. Run swizzle command: `npm run swizzle @docusaurus/theme-classic Root -- --wrap`
2. Edit `src/theme/Root.js`:

<div className="bg-slate-900 p-6 rounded-lg my-6 border border-slate-700">
  <h4 className="text-brand-400 font-bold mb-2">src/theme/Root.js</h4>
  <pre className="text-xs text-slate-300 overflow-x-auto">
{`import React from 'react';
import { ChatWidget } from '../components/ChatWidget';

// Default implementation, that you can customize
export default function Root({children}) {
  return (
    <>
      {children}
      <ChatWidget />
    </>
  );
}`}
  </pre>
</div>

## 6.4 The Result

You now have a documentation site that listens. Users can highlight a confusing paragraph about 'Authentication', click the chat bubble, and the Agent will explain it using the exact context of the paragraph plus the semantic knowledge from the entire vector database.
